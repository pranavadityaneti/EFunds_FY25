module.exports=[3747,(a,b,c)=>{"use strict";b.exports=a.r(96853).vendored["react-ssr"].ReactDOM},8490,a=>{"use strict";var b=a.i(93022);async function c(a,c,d,e,f,g){try{let{data:h,error:i}=await b.supabase.auth.signUp({email:a,password:c});if(i)throw i;if(!h.user)throw Error("No user returned from signup");let j="1SV-"+Math.random().toString(36).substring(2,8).toUpperCase(),k={id:h.user.id,email:a,mobile:e,name:d,company_name:"corporate_employee"===f||"corporate_admin"===f?g:void 0,role:f,customer_id:j},l=3;for(;l>0;)try{await new Promise(a=>setTimeout(a,1e3));let{error:c}=await b.supabase.from("users").insert({id:h.user.id,email:k.email,mobile:k.mobile,name:k.name,company_name:k.company_name,role:k.role,customer_id:k.customer_id});if(c){if("23503"===c.code)throw c;if("23505"===c.code){console.log("User profile already exists, checking for orphan...");let{data:c,error:d}=await b.supabase.from("users").select("*").eq("email",a).maybeSingle();if(!d&&c){if(c.id===h.user.id)return{...c,created_at:new Date(c.created_at),updated_at:new Date(c.updated_at)};console.log("Found orphaned profile. Linking to new Auth ID...");let{error:d}=await b.supabase.from("users").update({id:h.user.id,updated_at:new Date().toISOString()}).eq("email",a);if(d)throw console.error("Failed to link orphaned profile:",d),d;return{...c,id:h.user.id,created_at:new Date(c.created_at),updated_at:new Date}}}throw c}break}catch(a){if(l--,0===l)throw console.error("Failed to create user profile after retries:",a),Error("Failed to create user profile. Please try again.");console.log(`Retrying user profile creation... (${l} attempts left)`)}return{...k,created_at:new Date,updated_at:new Date}}catch(a){throw console.error("Signup error:",a),Error(a.message||"Failed to sign up")}}async function d(a){try{let{error:c}=await b.supabase.auth.resetPasswordForEmail(a,{redirectTo:"http://localhost:3000/update-password"});if(c)throw c}catch(a){throw console.error("Reset password error:",a),Error(a.message||"Failed to send reset password email")}}async function e(a,c){try{let{data:d,error:e}=await b.supabase.auth.signInWithPassword({email:a,password:c});if(e)throw e;if(!d.user)throw Error("No user returned from sign in");let{data:f,error:g}=await b.supabase.from("users").select("*").eq("id",d.user.id).maybeSingle();if(g)throw g;if(!f)throw Error("User profile not found. Please contact support.");return{id:f.id,email:f.email,mobile:f.mobile,name:f.name,company_name:f.company_name,role:f.role,created_at:new Date(f.created_at),updated_at:new Date(f.updated_at),rm_id:f.rm_id,customer_id:f.customer_id}}catch(a){throw console.error("Sign in error:",a),Error(a.message||"Failed to sign in")}}async function f(){try{let{error:a}=await b.supabase.auth.signOut();if(a)throw a}catch(a){throw console.error("Sign out error:",a),Error(a.message||"Failed to sign out")}}async function g(){try{let{data:{user:a}}=await b.supabase.auth.getUser();if(!a)return null;let{data:c,error:d}=await b.supabase.from("users").select("*").eq("id",a.id).maybeSingle();if(d)return console.error("Error fetching user data:",d),null;if(!c)return console.warn("User authenticated but no profile found"),null;return{id:c.id,email:c.email,mobile:c.mobile,name:c.name,company_name:c.company_name,role:c.role,created_at:new Date(c.created_at),updated_at:new Date(c.updated_at),rm_id:c.rm_id,customer_id:c.customer_id}}catch(a){return console.error("Error getting current user:",a),null}}function h(a){return b.supabase.auth.onAuthStateChange(async(b,c)=>{c?.user?a(await g()):a(null)})}a.s(["getCurrentUser",()=>g,"onAuthStateChange",()=>h,"resetPassword",()=>d,"signIn",()=>e,"signOut",()=>f,"signUp",()=>c])},81258,a=>{"use strict";let b=(0,a.i(42077).default)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);a.s(["Shield",()=>b],81258)},93049,a=>{"use strict";let b=(0,a.i(42077).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);a.s(["Calendar",()=>b],93049)},69499,a=>{"use strict";var b=a.i(29916),c=a.i(8490);function d(){let[a,d]=(0,b.useState)(null),[e,f]=(0,b.useState)(!0);return(0,b.useEffect)(()=>{let a=!0;(async()=>{try{let b=await (0,c.getCurrentUser)();a&&(d(b),f(!1))}catch(b){console.error("Error initializing auth:",b),a&&f(!1)}})();let{data:{subscription:b}}=(0,c.onAuthStateChange)(b=>{a&&(d(b),f(!1))});return()=>{a=!1,b.unsubscribe()}},[]),{user:a,loading:e}}a.s(["useAuth",()=>d])},5709,a=>{"use strict";let b=(0,a.i(42077).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);a.s(["ArrowRight",()=>b],5709)},1692,a=>{"use strict";let b=(0,a.i(42077).default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);a.s(["MessageSquare",()=>b],1692)},8605,1791,a=>{"use strict";var b=a.i(42077);let c=(0,b.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);a.s(["AlertTriangle",()=>c],8605);let d=(0,b.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>d],1791)}];

//# sourceMappingURL=OneSingleView_5ed62834._.js.map