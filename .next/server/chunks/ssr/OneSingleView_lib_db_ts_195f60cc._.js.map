{"version":3,"sources":["../../../../../OneSingleView/lib/db.ts"],"sourcesContent":["import { supabase } from './supabase';\nimport {\n    MotorPolicy,\n    HealthPolicy,\n    CommercialPolicy,\n    Claim,\n    QuoteRequest,\n    Referral,\n    User,\n    UserAuditLog,\n    AuditLog,\n    AppSetting,\n    Banner,\n    Garage,\n    UserPreferences,\n    RMInfo,\n} from '@/types';\n\n// Helper to convert database rows to app types\nfunction convertDates(data: any): any {\n    const converted = { ...data };\n    Object.keys(converted).forEach((key) => {\n        if (converted[key] && typeof converted[key] === 'string') {\n            // Try to parse as date\n            const dateValue = new Date(converted[key]);\n            if (!isNaN(dateValue.getTime()) && key.includes('date') || key.includes('_at')) {\n                converted[key] = dateValue;\n            }\n        }\n    });\n    return converted;\n}\n\n/**\n * Check for duplicate policy number\n */\nasync function checkDuplicatePolicy(table: string, userId: string, policyNumber: string): Promise<void> {\n    const { data, error } = await supabase\n        .from(table)\n        .select('id')\n        .eq('user_id', userId)\n        .eq('policy_number', policyNumber)\n        .maybeSingle();\n\n    if (data) {\n        throw new Error('This policy number already exists in your account');\n    }\n}\n\n/**\n * Get all motor policies for a user\n */\nexport async function getUserMotorPolicies(userId: string): Promise<MotorPolicy[]> {\n    try {\n        const { data, error } = await supabase\n            .from('motor_policies')\n            .select('*')\n            .eq('user_id', userId)\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => ({\n            ...convertDates(row),\n            id: row.id,\n            user_id: row.user_id,\n        })) as MotorPolicy[];\n    } catch (error: any) {\n        console.error('Error fetching motor policies:', error.message, error.details, error.hint);\n        return [];\n    }\n}\n\n/**\n * Get all GMC policies for a user\n */\nexport async function getUserHealthPolicies(userId: string): Promise<HealthPolicy[]> {\n    try {\n        const { data, error } = await supabase\n            .from('health_policies')\n            .select('*')\n            .eq('user_id', userId)\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as HealthPolicy[];\n    } catch (error: any) {\n        console.error('Error fetching health policies:', error.message, error.details, error.hint);\n        return [];\n    }\n}\n\n/**\n * Get all commercial policies for a user\n */\nexport async function getUserCommercialPolicies(\n    userId: string,\n    lobType?: 'GPA' | 'Fire' | 'Other'\n): Promise<CommercialPolicy[]> {\n    try {\n        let query = supabase\n            .from('commercial_policies')\n            .select('*')\n            .eq('user_id', userId);\n\n        if (lobType) {\n            query = query.eq('lob_type', lobType);\n        }\n\n        const { data, error } = await query.order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as CommercialPolicy[];\n    } catch (error: any) {\n        console.error('Error fetching commercial policies:', error.message, error.details, error.hint);\n        return [];\n    }\n}\n\n/**\n * Get all claims for a user\n */\nexport async function getUserClaims(userId: string): Promise<Claim[]> {\n    try {\n        const { data, error } = await supabase\n            .from('claims')\n            .select('*')\n            .eq('user_id', userId)\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as Claim[];\n    } catch (error: any) {\n        console.error('Error fetching claims:', error.message, error.details, error.hint);\n        return [];\n    }\n}\n\n/**\n * Get all quote requests for a user\n */\nexport async function getUserQuoteRequests(userId: string): Promise<QuoteRequest[]> {\n    try {\n        const { data, error } = await supabase\n            .from('quote_requests')\n            .select('*')\n            .eq('user_id', userId)\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as QuoteRequest[];\n    } catch (error: any) {\n        console.error('Error fetching quote requests:', error);\n        return [];\n    }\n}\n\n/**\n * Add a motor policy\n */\nexport async function addMotorPolicy(policy: Omit<MotorPolicy, 'id' | 'created_at' | 'updated_at'>): Promise<string> {\n    try {\n        await checkDuplicatePolicy('motor_policies', policy.user_id, policy.policy_number);\n\n        const { data, error } = await supabase\n            .from('motor_policies')\n            .insert({\n                user_id: policy.user_id,\n                policy_number: policy.policy_number,\n                vehicle_number: policy.vehicle_number,\n                vehicle_type: policy.vehicle_type,\n                manufacturer: policy.manufacturer,\n                model: policy.model,\n                fuel_type: policy.fuel_type,\n                manufacturing_year: policy.manufacturing_year,\n                number_plate_type: policy.number_plate_type,\n                insurer_name: policy.insurer_name,\n                premium_amount: policy.premium_amount,\n                policy_start_date: policy.policy_start_date,\n                policy_end_date: policy.policy_end_date,\n                rc_docs: policy.rc_docs || [],\n                previous_policy_docs: policy.previous_policy_docs || [],\n                dl_docs: policy.dl_docs || [],\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return data.id;\n    } catch (error: any) {\n        console.error('Error adding motor policy:', error);\n        throw new Error(error.message || 'Failed to add motor policy');\n    }\n}\n\n/**\n * Add a GMC policy\n */\nexport async function addHealthPolicy(policy: Omit<HealthPolicy, 'id' | 'created_at' | 'updated_at'>): Promise<string> {\n    try {\n        await checkDuplicatePolicy('health_policies', policy.user_id, policy.policy_number);\n\n        const { data, error } = await supabase\n            .from('health_policies')\n            .insert({\n                user_id: policy.user_id,\n                company_name: policy.company_name,\n                policy_number: policy.policy_number,\n                insurer_name: policy.insurer_name,\n                sum_insured: policy.sum_insured,\n                premium_amount: policy.premium_amount,\n                expiry_date: policy.expiry_date,\n                policy_docs: policy.policy_docs || [],\n                no_of_lives: policy.no_of_lives,\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return data.id;\n    } catch (error: any) {\n        console.error('Error adding health policy:', error);\n        throw new Error(error.message || 'Failed to add health policy');\n    }\n}\n\n/**\n * Add a commercial policy\n */\nexport async function addCommercialPolicy(policy: Omit<CommercialPolicy, 'id' | 'created_at' | 'updated_at'>): Promise<string> {\n    try {\n        await checkDuplicatePolicy('commercial_policies', policy.user_id, policy.policy_number);\n\n        const { data, error } = await supabase\n            .from('commercial_policies')\n            .insert({\n                user_id: policy.user_id,\n                lob_type: policy.lob_type,\n                company_name: policy.company_name,\n                policy_holder_name: policy.policy_holder_name,\n                policy_number: policy.policy_number,\n                insurer_name: policy.insurer_name,\n                premium_amount: policy.premium_amount,\n                sum_insured: policy.sum_insured,\n                expiry_date: policy.expiry_date,\n                policy_docs: policy.policy_docs || [],\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return data.id;\n    } catch (error: any) {\n        console.error('Error adding commercial policy:', error);\n        throw new Error(error.message || 'Failed to add commercial policy');\n    }\n}\n\n/**\n * Update a motor policy\n */\nexport async function updateMotorPolicy(id: string, updates: Partial<MotorPolicy>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('motor_policies')\n            .update(updates)\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating motor policy:', error);\n        throw new Error(error.message || 'Failed to update motor policy');\n    }\n}\n\n/**\n * Delete a motor policy\n */\nexport async function deleteMotorPolicy(id: string): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('motor_policies')\n            .delete()\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error deleting motor policy:', error);\n        throw new Error(error.message || 'Failed to delete motor policy');\n    }\n}\n\n/**\n * Update a GMC policy\n */\nexport async function updateHealthPolicy(id: string, updates: Partial<HealthPolicy>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('health_policies')\n            .update(updates)\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating health policy:', error);\n        throw new Error(error.message || 'Failed to update health policy');\n    }\n}\n\n/**\n * Delete a GMC policy\n */\nexport async function deleteHealthPolicy(id: string): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('health_policies')\n            .delete()\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error deleting health policy:', error);\n        throw new Error(error.message || 'Failed to delete health policy');\n    }\n}\n\n/**\n * Update a commercial policy\n */\nexport async function updateCommercialPolicy(id: string, updates: Partial<CommercialPolicy>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('commercial_policies')\n            .update(updates)\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating commercial policy:', error);\n        throw new Error(error.message || 'Failed to update commercial policy');\n    }\n}\n\n/**\n * Delete a commercial policy\n */\nexport async function deleteCommercialPolicy(id: string): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('commercial_policies')\n            .delete()\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error deleting commercial policy:', error);\n        throw new Error(error.message || 'Failed to delete commercial policy');\n    }\n}\n\n/**\n * Add a claim\n */\nexport async function addClaim(claim: Omit<Claim, 'id' | 'created_at' | 'updated_at'>): Promise<string> {\n    try {\n        const { data, error } = await supabase\n            .from('claims')\n            .insert({\n                user_id: claim.user_id,\n                policy_id: claim.policy_id,\n                lob_type: claim.lob_type,\n                claim_type: claim.claim_type,\n                incident_date: claim.incident_date,\n                description: claim.description,\n                supporting_docs: claim.supporting_docs || [],\n                status: claim.status,\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return data.id;\n    } catch (error: any) {\n        console.error('Error adding claim:', error);\n        throw new Error(error.message || 'Failed to add claim');\n    }\n}\n\n/**\n * Update a claim\n */\nexport async function updateClaim(id: string, updates: Partial<Claim>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('claims')\n            .update(updates)\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating claim:', error);\n        throw new Error(error.message || 'Failed to update claim');\n    }\n}\n\n/**\n * Add a quote request\n */\nexport async function addQuoteRequest(quote: Omit<QuoteRequest, 'id' | 'created_at'>): Promise<string> {\n    try {\n        const { data, error } = await supabase\n            .from('quote_requests')\n            .insert({\n                user_id: quote.user_id,\n                lob_type: quote.lob_type,\n                details: quote.details,\n                uploaded_quote: quote.uploaded_quote,\n                has_better_quote: quote.has_better_quote,\n                status: quote.status,\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return data.id;\n    } catch (error: any) {\n        console.error('Error adding quote request:', error);\n        throw new Error(error.message || 'Failed to add quote request');\n    }\n}\n\n/**\n * Update a quote request\n */\nexport async function updateQuoteRequest(id: string, updates: Partial<QuoteRequest>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('quote_requests')\n            .update(updates)\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating quote request:', error);\n        throw new Error(error.message || 'Failed to update quote request');\n    }\n}\n\n/**\n * Get all referrals for a user\n */\nexport async function getUserReferrals(userId: string): Promise<Referral[]> {\n    try {\n        const { data, error } = await supabase\n            .from('referrals')\n            .select('*')\n            .eq('user_id', userId)\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as Referral[];\n    } catch (error: any) {\n        console.error('Error fetching referrals:', error.message, error.details, error.hint);\n        return [];\n    }\n}\n\n/**\n * Add a referral\n */\nexport async function addReferral(referral: Omit<Referral, 'id' | 'created_at'>): Promise<string> {\n    try {\n        const { data, error } = await supabase\n            .from('referrals')\n            .insert({\n                user_id: referral.user_id,\n                friend_name: referral.friend_name,\n                friend_mobile: referral.friend_mobile,\n                friend_email: referral.friend_email,\n                notes: referral.notes,\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return data.id;\n    } catch (error: any) {\n        console.error('Error adding referral:', error);\n        throw new Error(error.message || 'Failed to add referral');\n    }\n}\n\n/**\n * Log user field change for audit\n */\nexport async function logUserChange(\n    userId: string,\n    field: 'email' | 'mobile',\n    oldValue: string,\n    newValue: string\n): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('user_audit_log')\n            .insert({\n                user_id: userId,\n                field_changed: field,\n                old_value: oldValue,\n                new_value: newValue,\n            });\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error logging user change:', error);\n    }\n}\n\n// --- Admin: User Management ---\n\n/**\n * Get all users (Admin only)\n */\nexport async function getAllUsers(): Promise<User[]> {\n    try {\n        const { data, error } = await supabase\n            .from('users')\n            .select('*')\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as User[];\n    } catch (error: any) {\n        console.error('Error fetching all users:', error);\n        return [];\n    }\n}\n\n/**\n * Get user details by ID (Admin)\n */\nexport async function getUserById(userId: string): Promise<User | null> {\n    try {\n        const { data, error } = await supabase\n            .from('users')\n            .select('*')\n            .eq('id', userId)\n            .single();\n\n        if (error) throw error;\n        return convertDates(data) as User;\n    } catch (error: any) {\n        console.error('Error fetching user details:', error);\n        return null;\n    }\n}\n\n\n\n/**\n * Update user status (Disable/Enable) - Mock implementation as 'status' field might not exist yet\n * In a real scenario, we would update a 'status' or 'is_active' column.\n * For now, we'll assume there's an 'is_active' column or similar in the 'users' table or just log it.\n */\nexport async function updateUserStatus(userId: string, status: 'active' | 'disabled'): Promise<void> {\n    try {\n        // TODO: Ensure 'status' column exists in users table.\n        // For now, we will just log this action as if it happened.\n        console.log(`Updating user ${userId} status to ${status}`);\n\n        // const { error } = await supabase\n        //     .from('users')\n        //     .update({ status })\n        //     .eq('id', userId);\n        // if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating user status:', error);\n        throw error;\n    }\n}\n\n\n\n// ... (keeping imports)\n\n/**\n * Get audit logs for a user (Admin)\n */\nexport async function getUserAuditLogs(userId: string): Promise<AuditLog[]> {\n    try {\n        const { data, error } = await supabase\n            .from('user_audit_log')\n            .select('*')\n            .eq('user_id', userId)\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as AuditLog[];\n    } catch (error: any) {\n        console.error('Error fetching audit logs:', error.message || error);\n        return [];\n    }\n}\n\n// --- Admin: Policy Management ---\n\n/**\n * Get all motor policies (Admin)\n */\nexport async function getAllMotorPolicies(): Promise<MotorPolicy[]> {\n    try {\n        const { data, error } = await supabase\n            .from('motor_policies')\n            .select('*, users(name, email)')\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => ({\n            ...convertDates(row),\n            user_name: row.users?.name,\n            user_email: row.users?.email\n        })) as MotorPolicy[];\n    } catch (error: any) {\n        console.error('Error fetching all motor policies:', error);\n        return [];\n    }\n}\n\n/**\n * Get all GMC policies (Admin)\n */\nexport async function getAllHealthPolicies(): Promise<HealthPolicy[]> {\n    try {\n        const { data, error } = await supabase\n            .from('health_policies')\n            .select('*, users(name, email)')\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => ({\n            ...convertDates(row),\n            user_name: row.users?.name,\n            user_email: row.users?.email\n        })) as HealthPolicy[];\n    } catch (error: any) {\n        console.error('Error fetching all health policies:', error);\n        return [];\n    }\n}\n\n/**\n * Get all commercial policies (Admin)\n */\nexport async function getAllCommercialPolicies(): Promise<CommercialPolicy[]> {\n    try {\n        const { data, error } = await supabase\n            .from('commercial_policies')\n            .select('*, users(name, email)')\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => ({\n            ...convertDates(row),\n            user_name: row.users?.name,\n            user_email: row.users?.email\n        })) as CommercialPolicy[];\n    } catch (error: any) {\n        console.error('Error fetching all commercial policies:', error);\n        return [];\n    }\n}\n\n// --- Admin: Operations ---\n\n/**\n * Get all claims (Admin)\n */\nexport async function getAllClaims(): Promise<Claim[]> {\n    try {\n        const { data, error } = await supabase\n            .from('claims')\n            .select('*, users(name, email)')\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => ({\n            ...convertDates(row),\n            user_name: row.users?.name,\n            user_email: row.users?.email\n        })) as Claim[];\n    } catch (error: any) {\n        console.error('Error fetching all claims:', error);\n        return [];\n    }\n}\n\n/**\n * Get all quote requests (Admin)\n */\nexport async function getAllQuoteRequests(): Promise<QuoteRequest[]> {\n    try {\n        const { data, error } = await supabase\n            .from('quote_requests')\n            .select('*, users(name, email)')\n            .order('created_at', { ascending: false });\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => ({\n            ...convertDates(row),\n            user_name: row.users?.name,\n            user_email: row.users?.email\n        })) as QuoteRequest[];\n    } catch (error: any) {\n        console.error('Error fetching all quote requests:', error);\n        return [];\n    }\n}\n\n// --- Admin: System Configuration ---\n\n/**\n * Get all app settings\n */\nexport async function getAppSettings(): Promise<AppSetting[]> {\n    try {\n        const { data, error } = await supabase\n            .from('app_settings')\n            .select('*')\n            .order('key');\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as AppSetting[];\n    } catch (error: any) {\n        console.error('Error fetching app settings:', error);\n        return [];\n    }\n}\n\n/**\n * Update an app setting\n */\nexport async function updateAppSetting(key: string, value: any): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('app_settings')\n            .upsert({ key, value, updated_at: new Date() });\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error updating app setting:', error);\n        throw error;\n    }\n}\n\n/**\n * Get all banners\n */\nexport async function getAllBanners(): Promise<Banner[]> {\n    try {\n        const { data, error } = await supabase\n            .from('banners')\n            .select('*')\n            .order('display_order');\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as Banner[];\n    } catch (error: any) {\n        console.error('Error fetching banners:', error);\n        return [];\n    }\n}\n\n/**\n * Add a banner\n */\nexport async function addBanner(banner: Omit<Banner, 'id' | 'created_at' | 'updated_at'>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('banners')\n            .insert(banner);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error adding banner:', error);\n        throw error;\n    }\n}\n\n/**\n * Delete a banner\n */\nexport async function deleteBanner(id: string): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('banners')\n            .delete()\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error deleting banner:', error);\n        throw error;\n    }\n}\n\n/**\n * Get all garages\n */\nexport async function getAllGarages(): Promise<Garage[]> {\n    try {\n        const { data, error } = await supabase\n            .from('garages')\n            .select('*')\n            .order('name');\n\n        if (error) throw error;\n\n        return (data || []).map((row: any) => convertDates(row)) as Garage[];\n    } catch (error: any) {\n        console.error('Error fetching garages:', error);\n        return [];\n    }\n}\n\n/**\n * Add a garage\n */\nexport async function addGarage(garage: Omit<Garage, 'id' | 'created_at' | 'updated_at'>): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('garages')\n            .insert(garage);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error adding garage:', error);\n        throw error;\n    }\n}\n\n/**\n * Delete a garage\n */\n/**\n * Delete a garage\n */\nexport async function deleteGarage(id: string): Promise<void> {\n    try {\n        const { error } = await supabase\n            .from('garages')\n            .delete()\n            .eq('id', id);\n\n        if (error) throw error;\n    } catch (error: any) {\n        console.error('Error deleting garage:', error);\n        throw error;\n    }\n}\n\n// ============================================\n// PROFILE MANAGEMENT FUNCTIONS\n// ============================================\n\n/**\n * Update user profile information\n */\nexport async function updateUserProfile(\n    userId: string,\n    updates: {\n        name?: string;\n        mobile?: string;\n        company_name?: string;\n        address?: string;\n    }\n): Promise<User> {\n    try {\n        const { data, error } = await supabase\n            .from('users')\n            .update(updates)\n            .eq('id', userId)\n            .select()\n            .single();\n\n        if (error) throw error;\n        return convertDates(data) as User;\n    } catch (error: any) {\n        console.error('Error updating user profile:', error);\n        throw error;\n    }\n}\n\n/**\n * Get Relationship Manager (RM) details for a user\n */\nexport async function getUserRM(userId: string): Promise<RMInfo | null> {\n    try {\n        // First get the user's rm_id\n        const { data: user, error: userError } = await supabase\n            .from('users')\n            .select('rm_id')\n            .eq('id', userId)\n            .single();\n\n        if (userError) {\n            // If user not found or error, return default RM for demo\n            console.log('Error fetching user for RM, returning default:', userError);\n            return {\n                name: 'Amit Sharma',\n                email: 'amit.sharma@onesingleview.com',\n                mobile: '+91 98765 43210'\n            };\n        }\n\n        if (!user?.rm_id) {\n            // Return default RM if none assigned\n            return {\n                name: 'Amit Sharma',\n                email: 'amit.sharma@onesingleview.com',\n                mobile: '+91 98765 43210'\n            };\n        }\n\n        // Then get the RM's details\n        const { data: rm, error: rmError } = await supabase\n            .from('users')\n            .select('name, email, mobile')\n            .eq('id', user.rm_id)\n            .single();\n\n        if (rmError) throw rmError;\n        return rm as RMInfo;\n    } catch (error: any) {\n        console.error('Error fetching user RM:', error);\n        // Return default RM on error to ensure UI shows something\n        return {\n            name: 'Amit Sharma',\n            email: 'amit.sharma@onesingleview.com',\n            mobile: '+91 98765 43210'\n        };\n    }\n}\n\n/**\n * Get user preferences, creating defaults if none exist\n */\nexport async function getUserPreferences(userId: string): Promise<UserPreferences> {\n    try {\n        const { data, error } = await supabase\n            .from('user_preferences')\n            .select('*')\n            .eq('user_id', userId)\n            .single();\n\n        if (error && error.code === 'PGRST116') {\n            // No preferences yet, create default\n            return await createDefaultPreferences(userId);\n        }\n\n        if (error) throw error;\n        return convertDates(data) as UserPreferences;\n    } catch (error: any) {\n        console.error('Error fetching user preferences:', error);\n        throw error;\n    }\n}\n\n/**\n * Create default preferences for a user\n */\nasync function createDefaultPreferences(userId: string): Promise<UserPreferences> {\n    try {\n        const defaultPrefs = {\n            user_id: userId,\n            email_notifications: true,\n            sms_notifications: false,\n            policy_expiry_alerts: true,\n            claim_updates: true,\n        };\n\n        const { data, error } = await supabase\n            .from('user_preferences')\n            .insert(defaultPrefs)\n            .select()\n            .single();\n\n        if (error) throw error;\n        return convertDates(data) as UserPreferences;\n    } catch (error: any) {\n        console.error('Error creating default preferences:', error);\n        throw error;\n    }\n}\n\n/**\n * Update user preferences\n */\nexport async function updateUserPreferences(\n    userId: string,\n    preferences: Partial<Omit<UserPreferences, 'id' | 'user_id' | 'created_at' | 'updated_at'>>\n): Promise<UserPreferences> {\n    try {\n        const { data, error } = await supabase\n            .from('user_preferences')\n            .upsert({\n                user_id: userId,\n                ...preferences,\n                updated_at: new Date().toISOString(),\n            })\n            .select()\n            .single();\n\n        if (error) throw error;\n        return convertDates(data) as UserPreferences;\n    } catch (error: any) {\n        console.error('Error updating user preferences:', error);\n        throw error;\n    }\n}\n\n// Life Policies\nexport async function getUserLifePolicies(userId: string) {\n    const { data, error } = await supabase\n        .from('life_policies')\n        .select('*')\n        .eq('user_id', userId)\n        .order('policy_end_date', { ascending: true });\n\n    if (error) throw error;\n    return (data || []).map((row: any) => convertDates(row));\n}\n\nexport async function addLifePolicy(policy: any) {\n    await checkDuplicatePolicy('life_policies', policy.user_id, policy.policy_number);\n    const { data, error } = await supabase\n        .from('life_policies')\n        .insert([policy])\n        .select()\n        .single();\n\n    if (error) throw error;\n    return data;\n}\n\n// Travel Policies\nexport async function getUserTravelPolicies(userId: string) {\n    const { data, error } = await supabase\n        .from('travel_policies')\n        .select('*')\n        .eq('user_id', userId)\n        .order('policy_end_date', { ascending: true });\n\n    if (error) throw error;\n    return (data || []).map((row: any) => convertDates(row));\n}\n\nexport async function addTravelPolicy(policy: any) {\n    await checkDuplicatePolicy('travel_policies', policy.user_id, policy.policy_number);\n    const { data, error } = await supabase\n        .from('travel_policies')\n        .insert([policy])\n        .select()\n        .single();\n\n    if (error) throw error;\n    return data;\n}\n\n/**\n * Get company's GMC policy by company name\n * Used by corporate employees to find their company's group health policy\n */\nexport async function getCompanyGMCPolicy(companyName: string) {\n    const { data, error } = await supabase\n        .from('health_policies')\n        .select('*')\n        .eq('company_name', companyName)\n        .maybeSingle();\n\n    if (error) throw error;\n    return data ? convertDates(data) : null;\n}\n\n// Cyber Policies\nexport async function getUserCyberPolicies(userId: string) {\n    const { data, error } = await supabase\n        .from('cyber_policies')\n        .select('*')\n        .eq('user_id', userId)\n        .order('policy_end_date', { ascending: true });\n\n    if (error) throw error;\n    return (data || []).map((row: any) => convertDates(row));\n}\n\nexport async function addCyberPolicy(policy: any) {\n    await checkDuplicatePolicy('cyber_policies', policy.user_id, policy.policy_number);\n    const { data, error } = await supabase\n        .from('cyber_policies')\n        .insert([policy])\n        .select()\n        .single();\n\n    if (error) throw error;\n    return data;\n}\n\n// Notifications\nexport async function getUserNotifications(userId: string) {\n    const { data, error } = await supabase\n        .from('notifications')\n        .select('*')\n        .eq('user_id', userId)\n        .order('created_at', { ascending: false })\n        .limit(20);\n\n    if (error) throw error;\n    return (data || []).map((row: any) => convertDates(row));\n}\n\nexport async function markNotificationAsRead(notificationId: string) {\n    const { error } = await supabase\n        .from('notifications')\n        .update({ is_read: true })\n        .eq('id', notificationId);\n\n    if (error) throw error;\n}\n\nexport async function markAllNotificationsAsRead(userId: string) {\n    const { error } = await supabase\n        .from('notifications')\n        .update({ is_read: true })\n        .eq('user_id', userId)\n        .eq('is_read', false);\n\n    if (error) throw error;\n}\n/**\n * Upload user avatar\n */\nexport async function uploadAvatar(userId: string, file: File): Promise<string | null> {\n    try {\n        const fileExt = file.name.split('.').pop();\n        const fileName = `${userId}-${Math.random()}.${fileExt}`;\n        const filePath = `${fileName}`;\n\n        // Upload file\n        const { error: uploadError } = await supabase.storage\n            .from('avatars')\n            .upload(filePath, file);\n\n        if (uploadError) {\n            throw uploadError;\n        }\n\n        // Get public URL\n        const { data } = supabase.storage\n            .from('avatars')\n            .getPublicUrl(filePath);\n\n        // Update user profile\n        const { error: updateError } = await supabase\n            .from('users')\n            .update({ avatar_url: data.publicUrl })\n            .eq('id', userId);\n\n        if (updateError) {\n            throw updateError;\n        }\n\n        return data.publicUrl;\n    } catch (error: any) {\n        console.error('Error uploading avatar:', error.message);\n        return null;\n    }\n}\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAmBA,SAAS,EAAa,CAAS,EAC3B,IAAM,EAAY,CAAE,GAAG,CAAI,AAAC,EAU5B,OATA,OAAO,IAAI,CAAC,GAAW,OAAO,CAAE,AAAD,IAC3B,GAAI,CAAS,CAAC,EAAI,EAA8B,UAA1B,OAAO,CAAS,CAAC,EAAI,CAAe,CAEtD,IAAM,EAAY,IAAI,KAAK,CAAS,CAAC,EAAI,GACrC,CAAC,MAAM,EAAU,OAAO,KAAO,EAAI,QAAQ,CAAC,SAAW,EAAI,QAAQ,CAAC,MAAA,GAAQ,CAC5E,CAAS,CAAC,EAAI,CAAG,CAAA,CAEzB,CACJ,GACO,CACX,CAKA,eAAe,EAAqB,CAAa,CAAE,CAAc,CAAE,CAAoB,EACnF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,GACL,MAAM,CAAC,MACP,EAAE,CAAC,UAAW,GACd,EAAE,CAAC,gBAAiB,GACpB,WAAW,GAEhB,GAAI,EACA,IADM,EACA,AAAI,MAAM,oDAExB,CAKO,eAAe,EAAqB,CAAc,EACrD,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAc,EACnC,CADkC,EAC/B,EAAa,EAAI,CACpB,GAAI,EAAI,EAAE,CACV,QAAS,EAAI,OAAO,CACxB,CAAC,CACL,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,iCAAkC,EAAM,OAAO,CAAE,EAAM,OAAO,CAAE,EAAM,IAAI,EACjF,EAAE,AACb,CACJ,CAKO,eAAe,EAAsB,CAAc,EACtD,GAAI,CACA,GAAM,CAAE,MAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,UAAW,EAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,kCAAmC,EAAM,OAAO,CAAE,EAAM,OAAO,CAAE,EAAM,IAAI,EAClF,EAAE,AACb,CACJ,CAKO,eAAe,EAClB,CAAc,CACd,CAAkC,EAElC,GAAI,CACA,IAAI,EAAQ,EAAA,QAAQ,CACf,IAAI,CAAC,uBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GAEf,GACA,GAAQ,EAAM,CADL,CACO,CAAC,WAAY,EAAA,EAGjC,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAM,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE3E,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,sCAAuC,EAAM,OAAO,CAAE,EAAM,OAAO,CAAE,EAAM,IAAI,EACtF,EAAE,AACb,CACJ,CAKO,eAAe,EAAc,CAAc,EAC9C,GAAI,CACA,GAAM,CAAE,MAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,UACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,UAAW,EAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,yBAA0B,EAAM,OAAO,CAAE,EAAM,OAAO,CAAE,EAAM,IAAI,EACzE,EAAE,AACb,CACJ,CAKO,eAAe,EAAqB,CAAc,EACrD,GAAI,CACA,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,iCAAkC,GACzC,EAAE,AACb,CACJ,CAKO,eAAe,EAAe,CAA6D,EAC9F,GAAI,CACA,MAAM,EAAqB,iBAAkB,EAAO,OAAO,CAAE,EAAO,aAAa,EAEjF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,CACJ,QAAS,EAAO,OAAO,CACvB,cAAe,EAAO,aAAa,CACnC,eAAgB,EAAO,cAAc,CACrC,aAAc,EAAO,YAAY,CACjC,aAAc,EAAO,YAAY,CACjC,MAAO,EAAO,KAAK,CACnB,UAAW,EAAO,SAAS,CAC3B,mBAAoB,EAAO,kBAAkB,CAC7C,kBAAmB,EAAO,iBAAiB,CAC3C,aAAc,EAAO,YAAY,CACjC,eAAgB,EAAO,cAAc,CACrC,kBAAmB,EAAO,iBAAiB,CAC3C,gBAAiB,EAAO,eAAe,CACvC,QAAS,EAAO,OAAO,EAAI,EAAE,CAC7B,qBAAsB,EAAO,oBAAoB,EAAI,EAAE,CACvD,QAAS,EAAO,OAAO,EAAI,EAAE,AACjC,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAK,EAAE,AAClB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,6BAA8B,GACtC,AAAI,MAAM,EAAM,OAAO,EAAI,6BACrC,CACJ,CAKO,eAAe,EAAgB,CAA8D,EAChG,GAAI,CACA,MAAM,EAAqB,kBAAmB,EAAO,OAAO,CAAE,EAAO,aAAa,EAElF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,CACJ,QAAS,EAAO,OAAO,CACvB,aAAc,EAAO,YAAY,CACjC,cAAe,EAAO,aAAa,CACnC,aAAc,EAAO,YAAY,CACjC,YAAa,EAAO,WAAW,CAC/B,eAAgB,EAAO,cAAc,CACrC,YAAa,EAAO,WAAW,CAC/B,YAAa,EAAO,WAAW,EAAI,EAAE,CACrC,YAAa,EAAO,WAAW,AACnC,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAK,EAAE,AAClB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,8BAA+B,GACvC,AAAI,MAAM,EAAM,OAAO,EAAI,8BACrC,CACJ,CAKO,eAAe,EAAoB,CAAkE,EACxG,GAAI,CACA,MAAM,EAAqB,sBAAuB,EAAO,OAAO,CAAE,EAAO,aAAa,EAEtF,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,uBACL,MAAM,CAAC,CACJ,QAAS,EAAO,OAAO,CACvB,SAAU,EAAO,QAAQ,CACzB,aAAc,EAAO,YAAY,CACjC,mBAAoB,EAAO,kBAAkB,CAC7C,cAAe,EAAO,aAAa,CACnC,aAAc,EAAO,YAAY,CACjC,eAAgB,EAAO,cAAc,CACrC,YAAa,EAAO,WAAW,CAC/B,YAAa,EAAO,WAAW,CAC/B,YAAa,EAAO,WAAW,EAAI,EAAE,AACzC,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAK,EAChB,AADkB,CAChB,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,kCAAmC,GAC3C,AAAI,MAAM,EAAM,OAAO,EAAI,kCACrC,CACJ,CAKO,eAAe,EAAkB,CAAU,CAAE,CAA6B,EAC7E,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,kBACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,+BAAgC,GACxC,AAAI,MAAM,EAAM,OAAO,EAAI,gCACrC,CACJ,CAKO,eAAe,EAAkB,CAAU,EAC9C,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,kBACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,+BAAgC,GACxC,AAAI,MAAM,EAAM,OAAO,EAAI,gCACrC,CACJ,CAKO,eAAe,EAAmB,CAAU,CAAE,CAA8B,EAC/E,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,mBACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,gCAAiC,GACzC,AAAI,MAAM,EAAM,OAAO,EAAI,iCACrC,CACJ,CAKO,eAAe,EAAmB,CAAU,EAC/C,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,mBACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,gCAAiC,GACrC,AAAJ,MAAU,EAAM,OAAO,EAAI,iCACrC,CACJ,CAKO,eAAe,EAAuB,CAAU,CAAE,CAAkC,EACvF,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,uBACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,oCAAqC,GAC7C,AAAI,MAAM,EAAM,OAAO,EAAI,qCACrC,CACJ,CAKO,eAAe,EAAuB,CAAU,EACnD,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,uBACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,oCAAqC,GACzC,AAAJ,MAAU,EAAM,OAAO,EAAI,qCACrC,CACJ,CAKO,eAAe,EAAS,CAAsD,EACjF,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,UACL,MAAM,CAAC,CACJ,QAAS,EAAM,OAAO,CACtB,UAAW,EAAM,SAAS,CAC1B,SAAU,EAAM,QAAQ,CACxB,WAAY,EAAM,UAAU,CAC5B,cAAe,EAAM,aAAa,CAClC,YAAa,EAAM,WAAW,CAC9B,gBAAiB,EAAM,eAAe,EAAI,EAAE,CAC5C,OAAQ,EAAM,MAAM,AACxB,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAK,EAAE,AAClB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,sBAAuB,GAC/B,AAAI,MAAM,EAAM,OAAO,EAAI,sBACrC,CACJ,CAKO,eAAe,EAAY,CAAU,CAAE,CAAuB,EACjE,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,UACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,wBAAyB,GACjC,AAAI,MAAM,EAAM,OAAO,EAAI,yBACrC,CACJ,CAKO,eAAe,EAAgB,CAA8C,EAChF,GAAI,CACA,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,CACJ,QAAS,EAAM,OAAO,CACtB,SAAU,EAAM,QAAQ,CACxB,QAAS,EAAM,OAAO,CACtB,eAAgB,EAAM,cAAc,CACpC,iBAAkB,EAAM,gBAAgB,CACxC,OAAQ,EAAM,MAAM,AACxB,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAK,EAAE,AAClB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,8BAA+B,GACvC,AAAI,MAAM,EAAM,OAAO,EAAI,8BACrC,CACJ,CAKO,eAAe,EAAmB,CAAU,CAAE,CAA8B,EAC/E,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,kBACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,gCAAiC,GACzC,AAAI,MAAM,EAAM,OAAO,EAAI,iCACrC,CACJ,CAKO,eAAe,EAAiB,CAAc,EACjD,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,aACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,4BAA6B,EAAM,OAAO,CAAE,EAAM,OAAO,CAAE,EAAM,IAAI,EAC5E,EAAE,AACb,CACJ,CAKO,eAAe,EAAY,CAA6C,EAC3E,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,aACL,MAAM,CAAC,CACJ,QAAS,EAAS,OAAO,CACzB,YAAa,EAAS,WAAW,CACjC,cAAe,EAAS,aAAa,CACrC,aAAc,EAAS,YAAY,CACnC,MAAO,EAAS,KAAK,AACzB,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAK,EAAE,AAClB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,yBAA0B,GAClC,AAAI,MAAM,EAAM,OAAO,EAAI,yBACrC,CACJ,CAKO,eAAe,EAClB,CAAc,CACd,CAAyB,CACzB,CAAgB,CAChB,CAAgB,EAEhB,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,kBACL,MAAM,CAAC,CACJ,QAAS,EACT,cAAe,EACf,UAAW,EACX,UAAW,CACf,GAEJ,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CACjB,QAAQ,KAAK,CAAC,6BAA8B,EAChD,CACJ,CAOO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,4BAA6B,GACpC,EAAE,AACb,CACJ,CAKO,eAAe,EAAY,CAAc,EAC5C,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,KAAM,GACT,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAa,EACxB,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,IACX,CACJ,CASO,eAAe,EAAiB,CAAc,CAAE,CAA6B,EAChF,GAAI,CAGA,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,EAAO,WAAW,EAAE,EAAA,CAAQ,CAO7D,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,8BAA+B,GACvC,CACV,CACJ,CASO,eAAe,EAAiB,CAAc,EACjD,GAAI,CACA,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,6BAA8B,EAAM,OAAO,EAAI,GACtD,EAAE,AACb,CACJ,CAOO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,yBACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,IAAc,CACnC,CADkC,EAC/B,EAAa,EAAI,CACpB,UAAW,EAAI,KAAK,EAAE,KACtB,WAAY,EAAI,KAAK,EAAE,MAC3B,CAAC,CACL,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,qCAAsC,GAC7C,EAAE,AACb,CACJ,CAKO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,yBACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,IAAc,CACnC,CADkC,EAC/B,EAAa,EAAI,CACpB,UAAW,EAAI,KAAK,EAAE,KACtB,WAAY,EAAI,KAAK,EAAE,MAC3B,CAAC,CACL,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,sCAAuC,GAC9C,EACX,AADa,CAEjB,CAKO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,uBACL,MAAM,CAAC,yBACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,IAAc,CACnC,CADkC,EAC/B,EAAa,EAAI,CACpB,UAAW,EAAI,KAAK,EAAE,KACtB,WAAY,EAAI,KAAK,EAAE,MAC3B,CAAC,CACL,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,0CAA2C,GAClD,EAAE,AACb,CACJ,CAOO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,UACL,MAAM,CAAC,yBACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,AAAC,IAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,IAAc,CACnC,CADkC,EAC/B,EAAa,EAAI,CACpB,UAAW,EAAI,KAAK,EAAE,KACtB,WAAY,EAAI,KAAK,EAAE,MAC3B,CAAC,CACL,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,6BAA8B,GACrC,EAAE,AACb,CACJ,CAKO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,yBACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE5C,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,IAAc,CACnC,CADkC,EAC/B,EAAa,EAAI,CACpB,UAAW,EAAI,KAAK,EAAE,KACtB,WAAY,EAAI,KAAK,EAAE,MAC3B,CAAC,CACL,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,qCAAsC,GAC7C,EAAE,AACb,CACJ,CAOO,eAAe,IAClB,GAAI,CACA,GAAM,CAAE,MAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,KAAK,CAAC,OAEX,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,EAAE,AACb,CACJ,CAKO,eAAe,EAAiB,CAAW,CAAE,CAAU,EAC1D,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,gBACL,MAAM,CAAC,KAAE,QAAK,EAAO,WAAY,IAAI,IAAO,GAEjD,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,8BAA+B,GACvC,CACV,CACJ,CAKO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,WACL,MAAM,CAAC,KACP,KAAK,CAAC,iBAEX,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,0BAA2B,GAClC,EAAE,AACb,CACJ,CAKO,eAAe,EAAU,CAAwD,EACpF,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,WACL,MAAM,CAAC,GAEZ,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,uBAAwB,GAChC,CACV,CACJ,CAKO,eAAe,EAAa,CAAU,EACzC,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,WACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,yBAA0B,GAClC,CACV,CACJ,CAKO,eAAe,IAClB,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,WACL,MAAM,CAAC,KACP,KAAK,CAAC,QAEX,GAAI,EAAO,MAAM,EAEjB,MAAO,CAAC,GAAQ,EAAE,AAAF,EAAI,GAAG,CAAE,AAAD,GAAc,EAAa,GACvD,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,0BAA2B,GAClC,EAAE,AACb,CACJ,CAKO,eAAe,EAAU,CAAwD,EACpF,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,WACL,MAAM,CAAC,GAEZ,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,uBAAwB,GAChC,CACV,CACJ,CAQO,eAAe,EAAa,CAAU,EACzC,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,WACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,yBAA0B,GAClC,CACV,CACJ,CASO,eAAe,EAClB,CAAc,CACd,CAKC,EAED,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,SACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GACT,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAa,EACxB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,+BAAgC,GACxC,CACV,CACJ,CAKO,eAAe,EAAU,CAAc,EAC1C,GAAI,CAEA,GAAM,CAAE,KAAM,CAAI,CAAE,MAAO,CAAS,CAAE,CAAG,MAAM,EAAA,QAAQ,CAClD,IAAI,CAAC,SACL,MAAM,CAAC,SACP,EAAE,CAAC,KAAM,GACT,MAAM,GAEX,GAAI,EAGA,OADA,EAFW,MAEH,GAAG,CAAC,iDAAkD,GACvD,CACH,KAAM,cACN,MAAO,gCACP,OAAQ,iBACZ,EAGJ,GAAI,CAAC,GAAM,MAEP,CAFc,KAEP,CACH,KAAM,cACN,MAAO,gCACP,OAAQ,iBACZ,EAIJ,GAAM,CAAE,KAAM,CAAE,CAAE,MAAO,CAAO,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC9C,IAAI,CAAC,SACL,MAAM,CAAC,uBACP,EAAE,CAAC,KAAM,EAAK,KAAK,EACnB,MAAM,GAEX,GAAI,EAAS,MAAM,EACnB,OAAO,CACX,CAAE,MAAO,EAAY,CAGjB,OAFA,QAAQ,KAAK,CAAC,0BAA2B,GAElC,CACH,KAAM,cACN,MAAO,gCACP,OAAQ,iBACZ,CACJ,CACJ,CAKO,eAAe,EAAmB,CAAc,EACnD,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,oBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,MAAM,GAEX,GAAI,GAAwB,YAAY,CAA3B,EAAM,IAAI,CAEnB,OAAO,MAAM,EAAyB,GAG1C,GAAI,EAAO,MAAM,EACjB,OAAO,EAAa,EACxB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,mCAAoC,GAC5C,CACV,CACJ,CAKA,eAAe,EAAyB,CAAc,EAClD,GAAI,CASA,GAAM,CAAE,MAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,oBACL,MAAM,CAVU,AAUT,CATR,QAAS,EACT,qBAAqB,EACrB,mBAAmB,EACnB,sBAAsB,EACtB,eAAe,CACnB,GAKK,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAa,EACxB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,sCAAuC,GAC/C,CACV,CACJ,CAKO,eAAe,EAClB,CAAc,CACd,CAA2F,EAE3F,GAAI,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,oBACL,MAAM,CAAC,CACJ,QAAS,EACT,GAAG,CAAW,CACd,WAAY,IAAI,OAAO,WAAW,EACtC,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,EAAa,EACxB,CAAE,MAAO,EAAY,CAEjB,MADA,QAAQ,KAAK,CAAC,mCAAoC,GAC5C,CACV,CACJ,CAGO,eAAe,EAAoB,CAAc,EACpD,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,kBAAmB,CAAE,WAAW,CAAK,GAEhD,GAAI,EAAO,MAAM,EACjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAEO,eAAe,EAAc,CAAW,EAC3C,MAAM,EAAqB,gBAAiB,EAAO,OAAO,CAAE,EAAO,aAAa,EAChF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC,EAAO,EACf,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,CACX,CAGO,eAAe,EAAsB,CAAc,EACtD,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,kBAAmB,CAAE,WAAW,CAAK,GAEhD,GAAI,EAAO,MAAM,EACjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAEO,eAAe,EAAgB,CAAW,EAC7C,MAAM,EAAqB,kBAAmB,EAAO,OAAO,CAAE,EAAO,aAAa,EAClF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,CAAC,EAAO,EACf,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,CACX,CAMO,eAAe,EAAoB,CAAmB,EACzD,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,eAAgB,GACnB,WAAW,GAEhB,GAAI,EAAO,MAAM,EACjB,OAAO,EAAO,EAAa,GAAQ,IACvC,CAGO,eAAe,EAAqB,CAAc,EACrD,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,kBAAmB,CAAE,WAAW,CAAK,GAEhD,GAAI,EAAO,MAAM,EACjB,MAAO,AAAC,IAAQ,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAa,EAAa,GACvD,CAEO,eAAe,EAAe,CAAW,EAC5C,MAAM,EAAqB,iBAAkB,EAAO,OAAO,CAAE,EAAO,aAAa,EACjF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,kBACL,MAAM,CAAC,CAAC,EAAO,EACf,MAAM,GACN,MAAM,GAEX,GAAI,EAAO,MAAM,EACjB,OAAO,CACX,CAGO,eAAe,GAAqB,CAAc,EACrD,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GACvC,KAAK,CAAC,IAEX,GAAI,EAAO,MAAM,EACjB,MAAO,CAAC,GAAQ,EAAA,AAAE,EAAE,GAAG,CAAE,AAAD,GAAc,EAAa,GACvD,CAEO,eAAe,GAAuB,CAAsB,EAC/D,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAE,QAAS,EAAK,GACvB,EAAE,CAAC,KAAM,GAEd,GAAI,EAAO,MAAM,CACrB,CAEO,eAAe,GAA2B,CAAc,EAC3D,GAAM,CAAE,OAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC3B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAE,QAAS,EAAK,GACvB,EAAE,CAAC,UAAW,GACd,EAAE,CAAC,WAAW,GAEnB,GAAI,EAAO,MAAM,CACrB,CAIO,eAAe,GAAa,CAAc,CAAE,CAAU,EACzD,GAAI,CACA,IAAM,EAAU,EAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,GAClC,EAAW,CAAA,EAAG,EAAO,CAAC,EAAE,KAAK,MAAM,GAAG,CAAC,EAAE,EAAA,CAAS,CAClD,EAAW,CAAA,EAAG,EAAA,CAAU,CAGxB,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAAA,QAAQ,CAAC,OAAO,CAChD,IAAI,CAAC,WACL,MAAM,CAAC,EAAU,GAEtB,GAAI,EACA,MAAM,EAIV,GALiB,AAKX,MAAE,CAAI,CAAE,CAAG,EAAA,QAAQ,CAAC,OAAO,CAC5B,IAAI,CAAC,WACL,YAAY,CAAC,GAGZ,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAAA,QAAQ,CACxC,IAAI,CAAC,SACL,MAAM,CAAC,CAAE,WAAY,EAAK,SAAS,AAAC,GACpC,EAAE,CAAC,KAAM,GAEd,GAAI,EACA,MAAM,EAGV,GAJiB,IAIV,EAAK,SAAS,AACzB,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,0BAA2B,EAAM,OAAO,EAC/C,IACX,CACJ"}